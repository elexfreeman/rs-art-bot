rs-bot-art — Telegram-бот для акварельных работ

Что делает
- Принимает фото (акварельная картина) в личных сообщениях.
- Анализирует цвета изображения и генерирует продающий текст (RU).
- Публикует фото с подписью в указанный Telegram-канал.
- По расписанию берёт изображение из папки `files`, избегает повторов по хэшу, и публикует.

Быстрый старт
1) Создайте бота у @BotFather и получите токен.
2) Добавьте бота администратором в ваш канал.
3) Узнайте числовой ID канала (формат -100xxxxxxxxxxxx).
https://api.telegram.org/bot{our_bot_token}/getUpdates
   - Самый простой способ — переслать любое сообщение из канала боту @userinfobot или @getidsbot.
4) Создайте JSON‑конфиг (можно взять `config.sample.json` как основу):

   {
     "teloxide_token": "123456:ABC-DEF...",
     "channel_id": -1001234567890,
     "post_interval_secs": 0,
     "post_cron": "30 10 * * *",
     "files_dir": "files",
     "db_path": "bot.db",
     "openai_api_key": "sk-...",
     "openai_model": "gpt-4o-mini",
     "openai_base": "https://api.openai.com",
     "openai_use_vision": true,
     "openai_vision_model": "gpt-4o",
     "openai_system_prompt": "..."
   }

5) Соберите и запустите:

   cargo run --release -- --config config.json

6) В личку боту отправьте команду:

   /set_channel -1001234567890

7) Теперь отправьте боту фото — он сгенерирует текст и опубликует пост в канал.
8) Для авто‑публикаций: сложите изображения в папку `files`, задайте `post_interval_secs>0` или `post_cron`, перезапустите бота.

Конфигурация
- Конфиг только через JSON‑файл с передачей `--config path/to/config.json` при запуске.
- `channel_id` из JSON используется один раз при первом запуске, затем актуальное значение хранится в SQLite и меняется командой `/set_channel`.
- Планировщик:
  - Если `post_interval_secs > 0` — публикует каждые N секунд.
  - Иначе, если задан `post_cron` — запускает по расписанию вида "M H * * *" (минуты/часы или `*`).
  - Время берётся по локальному времени системы.

Фоновая публикация из папки
- Папка: `files_dir` (по умолчанию `files`).
- На каждом срабатывании берётся первый подходящий файл (jpg/png/webp/gif/bmp/tiff) по имени, для него считается SHA‑256.
- Если хэш уже есть в БД — файл пропускается, берётся следующий. Иначе публикуется и хэш сохраняется.

База данных (SQLite)
- Путь к базе: `db_path` (по умолчанию `bot.db`).
- Таблицы:
  - `config(key TEXT PRIMARY KEY, value TEXT)` — хранит `channel_id`.
  - `files(hash TEXT PRIMARY KEY, path TEXT, created_at INTEGER)` — учёт уже опубликованных файлов по хэшу.
  - `posts(id INTEGER PK, channel_id INTEGER, message_id INTEGER, file_id TEXT, caption TEXT, created_at INTEGER)` — лог публикаций.

Команды бота
- /start — проверка готовности.
- /help — список команд.
- /set_channel <id> — задать канал (только числовой ID).
- /settings — показать текущие настройки.

Заметки
- При репосте фото из чата в канал используется имеющийся `file_id` (без повторной загрузки).
- При публикации из файловой системы загружается файл с диска.
- Анализ изображения локальный (доминирующие оттенки) + опционально Vision.
- Подпись укладывается в лимит Telegram (до 1024 символов).
- Vision: изображение кодируется в base64 и передаётся в Chat Completions как data URL. Если Vision выключен или недоступен — используется текстовая генерация с локальными признаками.
